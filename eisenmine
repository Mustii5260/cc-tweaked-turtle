-- =========================
-- FTB EVOLUTION STRIP MINER
-- Haupttunnel 200 | Strips 20
-- =========================

local TUNNEL_LAENGE = 200
local STRIP_LAENGE = 20
local STRIP_ABSTAND = 3
local MIN_FUEL = 600

-- ===== NUR MÜLL (ALLES ANDERE BLEIBT) =====
local junk = {
  ["minecraft:cobblestone"] = true,
  ["minecraft:cobbled_deepslate"] = true,
  ["minecraft:dirt"] = true,
  ["minecraft:gravel"] = true,
  ["minecraft:andesite"] = true,
  ["minecraft:diorite"] = true,
  ["minecraft:granite"] = true,
  ["minecraft:tuff"] = true
}

local steps = 0

-- ===== BASIC DIG =====
local function digForward()
  while turtle.detect() do turtle.dig() sleep(0.05) end
end

local function digUp()
  while turtle.detectUp() do turtle.digUp() sleep(0.05) end
end

local function digDown()
  while turtle.detectDown() do turtle.digDown() sleep(0.05) end
end

-- ===== 3x3 HAUPTTUNNEL =====
local function dig3x3Step()
  digForward()
  turtle.forward()
  digUp()
  if steps > 0 then digDown() end

  -- links
  turtle.turnLeft()
  digForward()
  turtle.forward()
  digUp()
  digDown()
  turtle.back()
  turtle.turnRight()

  -- rechts
  turtle.turnRight()
  digForward()
  turtle.forward()
  digUp()
  digDown()
  turtle.back()
  turtle.turnLeft()

  steps = steps + 1
end

-- ===== STRIP (1x2) =====
local function digStrip(length)
  for i = 1, length do
    digForward()
    turtle.forward()
    digUp()
  end

  turtle.turnLeft()
  turtle.turnLeft()
  for i = 1, length do turtle.forward() end
  turtle.turnLeft()
  turtle.turnLeft()
end

-- ===== INVENTAR =====
local function dropJunk()
  for i = 1, 16 do
    turtle.select(i)
    local item = turtle.getItemDetail()
    if item and junk[item.name] then
      turtle.drop()
    end
  end
end

local function inventoryFull()
  for i = 1, 16 do
    if turtle.getItemCount(i) == 0 then return false end
  end
  return true
end

-- ===== BASE =====
local function goHome()
  turtle.turnLeft()
  turtle.turnLeft()
  for i = 1, steps do turtle.forward() end
  turtle.turnLeft()
  turtle.turnLeft()
end

local function dumpInventoryDown()
  for i = 1, 16 do
    turtle.select(i)
    turtle.dropDown()
  end
end

-- ===== FUEL =====
local function refuel()
  turtle.turnLeft()
  turtle.suck(64)
  turtle.turnRight()
  for i = 1, 16 do
    turtle.select(i)
    turtle.refuel()
  end
end

local function ensureFuel()
  if turtle.getFuelLevel() < MIN_FUEL then
    print("Fuel niedrig – zurück zur Base")
    goHome()
    refuel()
  end
end

-- ===== START =====
print("FTB Evolution Strip-Mining gestartet ⛏️")

for i = 1, TUNNEL_LAENGE do
  dig3x3Step()
  dropJunk()
  ensureFuel()

  if steps % STRIP_ABSTAND == 0 then
    -- links
    turtle.turnLeft()
    digStrip(STRIP_LAENGE)
    turtle.turnRight()

    -- rechts
    turtle.turnRight()
    digStrip(STRIP_LAENGE)
    turtle.turnLeft()
  end

  if inventoryFull() then
    print("Inventar voll – Base")
    goHome()
    dumpInventoryDown()
  end
end

goHome()
dumpInventoryDown()
print("Strip-Mining fertig ✅")
