-- =========================
-- FTB EVOLUTION 3x3 MINER
-- behält ALLE ERZE & MOD-ITEMS
-- =========================

local TUNNEL_LAENGE = 200
local MIN_FUEL = 200

-- ===== MÜLL-LISTE (NUR DAS WIRD GEDROPPT) =====
local junk = {
  ["minecraft:cobblestone"] = true,
  ["minecraft:cobbled_deepslate"] = true,
  ["minecraft:dirt"] = true,
  ["minecraft:gravel"] = true,
  ["minecraft:andesite"] = true,
  ["minecraft:diorite"] = true,
  ["minecraft:granite"] = true,
  ["minecraft:tuff"] = true
}

local steps = 0

-- ===== GRABEN =====
local function digForward()
  while turtle.detect() do turtle.dig() sleep(0.1) end
end

local function digUp()
  while turtle.detectUp() do turtle.digUp() sleep(0.1) end
end

local function digDownSafe()
  while turtle.detectDown() do turtle.digDown() sleep(0.1) end
end

local function digSide(turn)
  turn()
  digForward()
  turtle.forward()
  digUp()
  digDownSafe()
  turtle.back()
  if turn == turtle.turnLeft then turtle.turnRight() else turtle.turnLeft() end
end

-- ===== 3x3 SCHRITT =====
local function mine3x3Step()
  digForward()
  turtle.forward()
  digUp()

  -- Base schützen
  if steps > 0 then digDownSafe() end

  digSide(turtle.turnLeft)
  digSide(turtle.turnRight)

  steps = steps + 1
end

-- ===== INVENTAR =====
local function inventoryFull()
  for i = 1, 16 do
    if turtle.getItemCount(i) == 0 then return false end
  end
  return true
end

-- nur Müll wegwerfen
local function dropJunk()
  for i = 1, 16 do
    turtle.select(i)
    local item = turtle.getItemDetail()
    if item and junk[item.name] then
      turtle.drop()
    end
  end
end

-- ===== BASE =====
local function goHome()
  turtle.turnLeft()
  turtle.turnLeft()
  for i = 1, steps do turtle.forward() end
  turtle.turnLeft()
  turtle.turnLeft()
end

local function dumpInventoryDown()
  for i = 1, 16 do
    turtle.select(i)
    turtle.dropDown()
  end
end

-- ===== FUEL =====
local function refuelFromChest()
  turtle.turnLeft()
  turtle.suck(64)
  turtle.turnRight()
  for i = 1, 16 do
    turtle.select(i)
    turtle.refuel()
  end
end

local function ensureFuel()
  if turtle.getFuelLevel() < MIN_FUEL then
    print("Fuel niedrig – tanke")
    goHome()
    refuelFromChest()
  end
end

-- ===== START =====
print("FTB Evolution 3x3 Miner gestartet ⛏️")

for i = 1, TUNNEL_LAENGE do
  mine3x3Step()
  dropJunk()
  ensureFuel()

  if inventoryFull() then
    print("Inventar voll – Base")
    goHome()
    dumpInventoryDown()
  end
end

goHome()
dumpInventoryDown()
print("Fertig ✅")
